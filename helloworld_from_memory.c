#include <sys/mman.h>

unsigned char func[] = 	{
			  0x50,0x57,0x56,0x52,0xe8,
			  0x00,0x00,0x00,0x00,0x5e,
			  0x48,0x81,0xc6,0x24,0x00,
			  0x00,0x00,0x48,0xc7,0xc0,
			  0x01,0x00,0x00,0x00,0x48,
			  0xc7,0xc7,0x01,0x00,0x00,
			  0x00,0x48,0xc7,0xc2,0x0e,
			  0x00,0x00,0x00,0x0f,0x05,
			  0x5a,0x5e,0x5f,0x5a,0xc3,
			  0x48,0x65,0x6c,0x6c,0x6f,
			  0x2c,0x20,0x57,0x6f,0x72,
			  0x6c,0x64,0x21,0x0a,0x00
			};

void print_helloworld()
{
    // char *str = "Hello World\n";
    // write(1, str, 12);

    // char *str = "Hello World\n";
    // asm ( "mov $12,%%rdx \n\t"
    //       "mov %[str], %%rsi \n\t"
    //       "mov $1,%%rdi \n\t"
    //       "mov $1,%%rax \n\t"
    //       "syscall       \n\t"
    //       :
    //       :[str] "r" (str)
    //       :);

    const int PAGE_SIZE = 4096;
    void *aligned_addr = (void *)((long long)func & ~(PAGE_SIZE-1));
    mprotect(aligned_addr, PAGE_SIZE, PROT_READ | PROT_WRITE | PROT_EXEC);
    ((void(*)(void))func)();
}

int main()
{
    print_helloworld();
}
